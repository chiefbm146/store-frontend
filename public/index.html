<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="./js/clean-url.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AARIE.CA - Your Store Built in 48 Hours</title>

    <meta property="og:type" content="website">
    <meta property="og:title" content="AARIE.CA - Your Store Built in 48 Hours">
    <meta property="og:description" content="We build professional online stores with AI-powered chat in 24-48 hours - you don't have to lift a finger">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>üè™</text></svg>">

    <!-- Critical CSS - Loading Animation (Inlined for Performance) -->
    <style>
        /* App Shell Loading State */
        body.is-loading {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body.is-loading .hero-section,
        body.is-loading .features-section,
        body.is-loading .chat-section,
        body.is-loading .about-section,
        body.is-loading .cta-section,
        body.is-loading footer {
            display: none;
        }

        /* Elegant Edge Loading Animation - Sweeping border gradient */
        #edge-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99999;
            opacity: 0;
            transition: opacity 0.6s ease-out;
        }

        body.is-loading #edge-loader {
            opacity: 1;
        }

        #edge-loader::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: conic-gradient(from 0deg,
                #6366f1 0deg,
                #6366f1 45deg,
                transparent 90deg,
                transparent 360deg
            );
            animation: edgeSweep 2s linear infinite;
            border-radius: 0;
        }

        #edge-loader::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            pointer-events: none;
        }

        @keyframes edgeSweep {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* Content Fade-In */
        body:not(.is-loading) .hero-section,
        body:not(.is-loading) .features-section,
        body:not(.is-loading) .chat-section,
        body:not(.is-loading) .about-section,
        body:not(.is-loading) .cta-section,
        body:not(.is-loading) footer {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
    </style>

    <!-- CSS -->
    <link rel="stylesheet" href="./css/desktop.css">
    <link rel="stylesheet" href="./css/mobile-index.css">
    <link rel="stylesheet" href="./libs/fontawesome/all.min.css">

    <!-- Flatpickr -->
    <link rel="stylesheet" href="./libs/flatpickr/flatpickr.min.css">
    <script src="./libs/flatpickr/flatpickr.min.js"></script>
</head>
<body>
    <!-- Edge Loading Animation - Only shows on first visit or uncached -->
    <div id="edge-loader"></div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <span class="hero-icon" id="hero-icon"></span>
            <h1 class="hero-title" id="hero-title"></h1>
            <p class="hero-subtitle" id="hero-subtitle"></p>
            <p class="hero-description" id="hero-description"></p>
            <div class="hero-buttons">
                <a href="/demo-desk.html" class="btn btn-primary" id="hero-cta-primary"></a>
                <p class="client-explore-text" id="client-explore-text"></p>
                <a href="https://moontidereconciliation.com" class="btn btn-secondary" id="hero-cta-secondary" target="_blank" rel="noopener"></a>
            </div>
        </div>
    </section>

    <!-- Who Is This For Section -->
    <section class="who-section">
        <div class="who-content">
            <div class="section-header">
                <h2 class="section-title" id="who-title"></h2>
                <p class="section-subtitle" id="who-subtitle"></p>
            </div>

            <div class="who-highlight" id="who-highlight"></div>

            <div class="business-types-grid" id="business-types-grid">
                <!-- Populated by JS -->
            </div>

            <div class="examples-section">
                <h3 class="examples-title" id="examples-title"></h3>
                <div class="examples-grid" id="examples-grid">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="advantage-box" id="advantage-box">
                <!-- Populated by JS -->
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features-section">
        <div class="section-header">
            <h2 class="section-title" id="features-title"></h2>
            <p class="section-subtitle" id="features-subtitle"></p>
        </div>
        <div class="features-grid" id="features-grid">
            <!-- Populated by JS -->
        </div>
    </section>

    <!-- Chat Section -->
    <section class="chat-section" id="chat">
        <div class="chat-wrapper">
            <div class="section-header">
                <h2 class="section-title" id="chat-title"></h2>
                <p class="section-subtitle" id="chat-subtitle"></p>
            </div>

            <div class="chat-container">
                <div class="chat-header">
                    <span class="chat-icon">ü§ñ</span>
                    <h3 class="chat-title">AI Chat Assistant</h3>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <div class="messages" id="messages">
                        <!-- Starter message will be injected by JS -->
                    </div>
                    <div class="typing-indicator" id="typingIndicator">
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                    </div>
                    <div id="moduleContainer"></div>
                </div>

                <div class="input-area">
                    <div class="input-wrapper">
                        <input type="text" id="userInput" placeholder="Ask about our products, services, or workshops..." autocomplete="off" maxlength="4000">
                    </div>
                    <button id="sendButton">Send</button>
                </div>
            </div>
        </div>
    </section>

    <!-- AI Blurb Section (Mobile Only - replaces chat section) -->
    <section class="ai-blurb-section">
        <div class="ai-blurb-content">
            <span class="ai-blurb-icon">ü§ñ</span>
            <h3 class="ai-blurb-title">Custom AI For Your Business</h3>
            <p class="ai-blurb-text">Every store we build includes a custom AI chatbot with its own personality - professional, helpful, and trained specifically on your business. Your customers get instant answers about your offerings 24/7, and it's always safe and on-brand.</p>
            <button class="ai-blurb-cta" onclick="openMobileChat()">Try Our AI Assistant</button>
        </div>
    </section>

    <!-- About Section -->
    <section class="about-section" id="about">
        <div class="about-content">
            <div class="about-text">
                <h2 id="about-title"></h2>
                <h3 id="about-subtitle"></h3>
                <div id="about-paragraphs">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="about-visual">
                <span class="about-emoji" id="about-emoji"></span>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <div class="cta-content">
            <h2 id="cta-title"></h2>
            <p id="cta-description"></p>
            <div class="cta-buttons">
                <a href="/demo-desk.html" class="btn btn-primary" id="cta-button-primary"></a>
                <a href="https://moontidereconciliation.com" class="btn btn-secondary" id="cta-button-secondary" target="_blank" rel="noopener"></a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p class="footer-tagline" id="footer-tagline"></p>
            <div class="footer-links" id="footer-links">
                <!-- Populated by JS -->
            </div>
            <p class="footer-copyright" id="footer-copyright"></p>
        </div>
    </footer>

    <!-- Hidden audio player for TTS -->
    <audio id="ttsPlayer" style="display: none;"></audio>

    <!-- Mobile Floating Chat Button -->
    <button class="mobile-chat-fab" onclick="openMobileChat()" title="Chat with AI">
        ü§ñ
    </button>

    <!-- Mobile Chat Overlay -->
    <div class="mobile-chat-overlay" id="mobileChatOverlay" onclick="closeMobileChat()"></div>

    <!-- Mobile Fullscreen Chat Modal -->
    <div class="mobile-chat-modal" id="mobileChatModal">
        <div class="mobile-chat-header">
            <h3 class="mobile-chat-title">ü§ñ AI Assistant</h3>
            <button class="mobile-chat-close" onclick="closeMobileChat()">‚úï</button>
        </div>
        <div class="mobile-chat-body">
            <div class="mobile-chat-messages" id="mobileChatMessages">
                <div class="mobile-chat-message ai">
                    Hi! üëã I'm your AI assistant from AARIE.CA. We build professional online stores in just 24-48 hours. Ask me anything about our services, pricing, or how we can help your business!
                </div>
            </div>
            <div class="mobile-typing-indicator" id="mobileTypingIndicator">
                <span class="mobile-typing-dot"></span>
                <span class="mobile-typing-dot"></span>
                <span class="mobile-typing-dot"></span>
            </div>
        </div>
        <div class="mobile-chat-input-area">
            <input type="text" class="mobile-chat-input" id="mobileChatInput" placeholder="Ask me anything..." maxlength="4000">
            <button class="mobile-chat-send" onclick="sendMobileMessage()">Send</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./js/version-manager.js"></script>
    <script src="./js/device-detector.js"></script>

    <!-- Config System: Theme & Content -->
    <script type="module">
        import { injectTheme } from './js/theme-injector.js';
        import desktopPage from './js/config/content/desktop.js';

        // Inject theme IMMEDIATELY (synchronous)
        injectTheme();

        // Loading state disabled - no caching
        // const isFirstVisit = !sessionStorage.getItem('page-loaded');
        // if (isFirstVisit) {
        //     document.body.classList.add('is-loading');
        //     sessionStorage.setItem('page-loaded', 'true');
        // }
        const isFirstVisit = false;

        // Populate landing page content
        document.addEventListener('DOMContentLoaded', () => {
            // Hero Section
            document.getElementById('hero-icon').textContent = desktopPage.hero.icon;
            document.getElementById('hero-title').textContent = desktopPage.hero.title;
            document.getElementById('hero-subtitle').textContent = desktopPage.hero.subtitle;
            document.getElementById('hero-description').textContent = desktopPage.hero.description;
            document.getElementById('hero-cta-primary').textContent = desktopPage.hero.ctaPrimary.text;
            document.getElementById('hero-cta-primary').href = desktopPage.hero.ctaPrimary.link;
            document.getElementById('hero-cta-primary').setAttribute('data-loaded', 'true');

            // Hero secondary button and client explore text
            document.getElementById('client-explore-text').textContent = desktopPage.hero.clientExploreText;
            document.getElementById('hero-cta-secondary').textContent = desktopPage.hero.ctaSecondary.text;
            document.getElementById('hero-cta-secondary').href = desktopPage.hero.ctaSecondary.link;

            // Who Is This For Section
            document.getElementById('who-title').textContent = desktopPage.whoIsThisFor.title;
            document.getElementById('who-subtitle').textContent = desktopPage.whoIsThisFor.subtitle;
            document.getElementById('who-highlight').textContent = desktopPage.whoIsThisFor.highlight;

            const businessTypesGrid = document.getElementById('business-types-grid');
            businessTypesGrid.innerHTML = desktopPage.whoIsThisFor.businessTypes.map(type => `
                <div class="business-type-card">
                    <span class="business-type-icon">${type.icon}</span>
                    <h3 class="business-type-title">${type.title}</h3>
                    <p class="business-type-description">${type.description}</p>
                </div>
            `).join('');

            document.getElementById('examples-title').textContent = desktopPage.whoIsThisFor.examples.title;
            const examplesGrid = document.getElementById('examples-grid');
            examplesGrid.innerHTML = desktopPage.whoIsThisFor.examples.items.map(item => `
                <div class="example-item">
                    <span class="example-icon">${item.icon}</span>
                    <span class="example-text">${item.text}</span>
                </div>
            `).join('');

            const advantageBox = document.getElementById('advantage-box');
            advantageBox.innerHTML = `
                <span class="advantage-icon">${desktopPage.whoIsThisFor.advantage.icon}</span>
                <h3 class="advantage-title">${desktopPage.whoIsThisFor.advantage.title}</h3>
                <p class="advantage-description">${desktopPage.whoIsThisFor.advantage.description}</p>
            `;

            // Features Section
            document.getElementById('features-title').textContent = desktopPage.features.title;
            document.getElementById('features-subtitle').textContent = desktopPage.features.subtitle;

            const featuresGrid = document.getElementById('features-grid');
            featuresGrid.innerHTML = desktopPage.features.items.map(feature => `
                <div class="feature-card">
                    <span class="feature-icon">${feature.icon}</span>
                    <h3 class="feature-title">${feature.title}</h3>
                    <p class="feature-description">${feature.description}</p>
                </div>
            `).join('');

            // Chat Section
            document.getElementById('chat-title').textContent = desktopPage.chat.title;
            document.getElementById('chat-subtitle').textContent = desktopPage.chat.subtitle;
            document.getElementById('userInput').placeholder = desktopPage.chat.placeholder;

            // Add AI starter message
            const messagesDiv = document.getElementById('messages');
            const starterMessage = document.createElement('div');
            starterMessage.className = 'message ai-message';
            starterMessage.innerHTML = `
                <div class="message-content">
                    <span class="message-icon">ü§ñ</span>
                    <div class="message-text">
                        <p>Hi! üëã I'm your AI assistant from AARIE.CA. We build professional online stores in just 24-48 hours - you don't have to do anything! I can tell you about our store building services, features, pricing, or answer any questions. Ready to get your store online?</p>
                    </div>
                </div>
            `;
            messagesDiv.appendChild(starterMessage);

            // About Section
            document.getElementById('about-title').textContent = desktopPage.about.title;
            document.getElementById('about-subtitle').textContent = desktopPage.about.subtitle;
            document.getElementById('about-emoji').textContent = desktopPage.about.emoji;

            const aboutParagraphs = document.getElementById('about-paragraphs');
            aboutParagraphs.innerHTML = desktopPage.about.content.map(p => `<p>${p}</p>`).join('');

            // CTA Section
            document.getElementById('cta-title').textContent = desktopPage.cta.title;
            document.getElementById('cta-description').textContent = desktopPage.cta.description;
            document.getElementById('cta-button-primary').textContent = desktopPage.cta.buttonPrimary.text;
            document.getElementById('cta-button-primary').href = desktopPage.cta.buttonPrimary.link;
            document.getElementById('cta-button-secondary').textContent = desktopPage.cta.buttonSecondary.text;
            document.getElementById('cta-button-secondary').href = desktopPage.cta.buttonSecondary.link;

            // Footer
            document.getElementById('footer-tagline').textContent = desktopPage.footer.tagline;
            document.getElementById('footer-copyright').textContent = desktopPage.footer.copyright;

            const footerLinks = document.getElementById('footer-links');
            footerLinks.innerHTML = desktopPage.footer.links.map(link =>
                `<a href="${link.url}">${link.text}</a>`
            ).join('');

            console.log('[Index] Platform landing page loaded from config');

            // Remove loading state - trigger fade-out and content reveal
            // Only if loading was shown (first visit)
            if (isFirstVisit) {
                requestAnimationFrame(() => {
                    document.body.classList.remove('is-loading');

                    // Remove edge loader from DOM after fade-out completes
                    setTimeout(() => {
                        const edgeLoader = document.getElementById('edge-loader');
                        if (edgeLoader) {
                            edgeLoader.remove();
                        }
                    }, 600); // Match CSS transition duration
                });
            }
        });
    </script>

    <!-- Mobile Chat Functions -->
    <script>
        // ========================================
        // MOBILE CHAT CONFIGURATION
        // ========================================
        const BACKEND_URL = 'https://stores-backend-phhl2xgwwa-uc.a.run.app';
        const CHAT_ENDPOINT = '/chat';
        let MOBILE_CHAT_SESSION_ID = null;

        // Initialize session
        function initMobileChatSession() {
            MOBILE_CHAT_SESSION_ID = sessionStorage.getItem('mobile_chat_session_id');
            if (!MOBILE_CHAT_SESSION_ID) {
                MOBILE_CHAT_SESSION_ID = 'mobile_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                sessionStorage.setItem('mobile_chat_session_id', MOBILE_CHAT_SESSION_ID);
            }
        }

        function openMobileChat() {
            document.getElementById('mobileChatModal').classList.add('active');
            document.getElementById('mobileChatOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
            // Don't auto-focus - let user see chat and choose to type
        }

        function closeMobileChat() {
            document.getElementById('mobileChatModal').classList.remove('active');
            document.getElementById('mobileChatOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function sendMobileMessage() {
            const input = document.getElementById('mobileChatInput');
            const messagesDiv = document.getElementById('mobileChatMessages');
            const typingIndicator = document.getElementById('mobileTypingIndicator');
            const userText = input.value.trim();

            if (!userText) return;

            input.disabled = true;

            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'mobile-chat-message user';
            userMsg.textContent = userText;
            messagesDiv.appendChild(userMsg);
            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // Show typing indicator
            typingIndicator.classList.add('visible');

            try {
                const payload = {
                    session_id: MOBILE_CHAT_SESSION_ID,
                    prompt: userText,
                    device_fingerprint: 'mobile-landing-' + navigator.userAgent.substring(0, 50)
                };

                const response = await fetch(BACKEND_URL + CHAT_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const aiResponse = data.response || 'Sorry, I could not generate a response.';

                // Hide typing indicator
                typingIndicator.classList.remove('visible');

                // Add AI message
                const aiMsg = document.createElement('div');
                aiMsg.className = 'mobile-chat-message ai';
                aiMsg.textContent = aiResponse;
                messagesDiv.appendChild(aiMsg);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;

            } catch (error) {
                console.error('[Mobile Chat] Error:', error);
                typingIndicator.classList.remove('visible');

                const aiMsg = document.createElement('div');
                aiMsg.className = 'mobile-chat-message ai';
                aiMsg.textContent = 'Sorry, I encountered an error. Please try again.';
                messagesDiv.appendChild(aiMsg);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            } finally {
                input.disabled = false;
                // Close keyboard after sending
                input.blur();
                messagesDiv.focus();
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            initMobileChatSession();

            const mobileInput = document.getElementById('mobileChatInput');
            if (mobileInput) {
                mobileInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !mobileInput.disabled) {
                        sendMobileMessage();
                    }
                });
            }

            // Close modal with Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeMobileChat();
            });
        });
    </script>

    <!-- Service Worker for Caching - DISABLED DURING DOMAIN VALIDATION -->
    <!-- <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('[ServiceWorker] Registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('[ServiceWorker] Registration failed:', error);
                    });
            });
        }
    </script> -->
</body>
</html>
