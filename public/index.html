<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="./js/clean-url.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Store Platform - Build Your Store in Minutes</title>

    <meta property="og:type" content="website">
    <meta property="og:title" content="Your Store Platform - Build Your Store in Minutes">
    <meta property="og:description" content="Create a professional online store with AI-powered chat - no coding required">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>üè™</text></svg>">

    <!-- Critical CSS - Loading Animation (Inlined for Performance) -->
    <style>
        /* App Shell Loading State */
        body.is-loading {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body.is-loading .hero-section,
        body.is-loading .features-section,
        body.is-loading .chat-section,
        body.is-loading .about-section,
        body.is-loading .cta-section,
        body.is-loading footer {
            display: none;
        }

        /* Elegant Edge Loading Animation - Sweeping border gradient */
        #edge-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99999;
            opacity: 0;
            transition: opacity 0.6s ease-out;
        }

        body.is-loading #edge-loader {
            opacity: 1;
        }

        #edge-loader::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: conic-gradient(from 0deg,
                #6366f1 0deg,
                #6366f1 45deg,
                transparent 90deg,
                transparent 360deg
            );
            animation: edgeSweep 2s linear infinite;
            border-radius: 0;
        }

        #edge-loader::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            pointer-events: none;
        }

        @keyframes edgeSweep {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* Content Fade-In */
        body:not(.is-loading) .hero-section,
        body:not(.is-loading) .features-section,
        body:not(.is-loading) .chat-section,
        body:not(.is-loading) .about-section,
        body:not(.is-loading) .cta-section,
        body:not(.is-loading) footer {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
    </style>

    <!-- CSS -->
    <link rel="stylesheet" href="./css/desktop.css">
    <link rel="stylesheet" href="./libs/fontawesome/all.min.css">

    <!-- Flatpickr -->
    <link rel="stylesheet" href="./libs/flatpickr/flatpickr.min.css">
    <script src="./libs/flatpickr/flatpickr.min.js"></script>
</head>
<body>
    <!-- Edge Loading Animation - Only shows on first visit or uncached -->
    <div id="edge-loader"></div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <span class="hero-icon" id="hero-icon"></span>
            <h1 class="hero-title" id="hero-title"></h1>
            <p class="hero-subtitle" id="hero-subtitle"></p>
            <p class="hero-description" id="hero-description"></p>
            <div class="hero-buttons">
                <a href="/demo-desk.html" class="btn btn-primary" id="hero-cta-primary"></a>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features-section">
        <div class="section-header">
            <h2 class="section-title" id="features-title"></h2>
            <p class="section-subtitle" id="features-subtitle"></p>
        </div>
        <div class="features-grid" id="features-grid">
            <!-- Populated by JS -->
        </div>
    </section>

    <!-- Chat Section -->
    <section class="chat-section" id="chat">
        <div class="chat-wrapper">
            <div class="section-header">
                <h2 class="section-title" id="chat-title"></h2>
                <p class="section-subtitle" id="chat-subtitle"></p>
            </div>

            <div class="chat-container">
                <div class="chat-header">
                    <span class="chat-icon">ü§ñ</span>
                    <h3 class="chat-title">AI Chat Assistant</h3>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <div class="messages" id="messages">
                        <!-- Starter message will be injected by JS -->
                    </div>
                    <div class="typing-indicator" id="typingIndicator">
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                    </div>
                    <div id="moduleContainer"></div>
                </div>

                <div class="input-area">
                    <div class="input-wrapper">
                        <input type="text" id="userInput" placeholder="Ask about our products, services, or workshops..." autocomplete="off" maxlength="4000">
                    </div>
                    <button id="sendButton">Send</button>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="about-section" id="about">
        <div class="about-content">
            <div class="about-text">
                <h2 id="about-title"></h2>
                <h3 id="about-subtitle"></h3>
                <div id="about-paragraphs">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="about-visual">
                <span class="about-emoji" id="about-emoji"></span>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <div class="cta-content">
            <h2 id="cta-title"></h2>
            <p id="cta-description"></p>
            <a href="/shop-desk.html" class="btn btn-primary" id="cta-button"></a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p class="footer-tagline" id="footer-tagline"></p>
            <div class="footer-links" id="footer-links">
                <!-- Populated by JS -->
            </div>
            <p class="footer-copyright" id="footer-copyright"></p>
        </div>
    </footer>

    <!-- Hidden audio player for TTS -->
    <audio id="ttsPlayer" style="display: none;"></audio>

    <!-- Scripts -->
    <script src="./js/version-manager.js"></script>
    <script src="./js/device-detector.js"></script>

    <!-- Config System: Theme & Content -->
    <script type="module">
        import { injectTheme } from './js/theme-injector.js';
        import desktopPage from './js/config/content/desktop.js';

        // Inject theme IMMEDIATELY (synchronous)
        injectTheme();

        // Check if this is first visit or content is uncached
        // Only show loading animation on first visit per session
        const isFirstVisit = !sessionStorage.getItem('page-loaded');
        if (isFirstVisit) {
            document.body.classList.add('is-loading');
            sessionStorage.setItem('page-loaded', 'true');
        }

        // Populate landing page content
        document.addEventListener('DOMContentLoaded', () => {
            // Hero Section
            document.getElementById('hero-icon').textContent = desktopPage.hero.icon;
            document.getElementById('hero-title').textContent = desktopPage.hero.title;
            document.getElementById('hero-subtitle').textContent = desktopPage.hero.subtitle;
            document.getElementById('hero-description').textContent = desktopPage.hero.description;
            document.getElementById('hero-cta-primary').textContent = desktopPage.hero.ctaPrimary.text;
            document.getElementById('hero-cta-primary').href = desktopPage.hero.ctaPrimary.link;
            document.getElementById('hero-cta-primary').setAttribute('data-loaded', 'true');

            // Features Section
            document.getElementById('features-title').textContent = desktopPage.features.title;
            document.getElementById('features-subtitle').textContent = desktopPage.features.subtitle;

            const featuresGrid = document.getElementById('features-grid');
            featuresGrid.innerHTML = desktopPage.features.items.map(feature => `
                <div class="feature-card">
                    <span class="feature-icon">${feature.icon}</span>
                    <h3 class="feature-title">${feature.title}</h3>
                    <p class="feature-description">${feature.description}</p>
                </div>
            `).join('');

            // Chat Section
            document.getElementById('chat-title').textContent = desktopPage.chat.title;
            document.getElementById('chat-subtitle').textContent = desktopPage.chat.subtitle;
            document.getElementById('userInput').placeholder = desktopPage.chat.placeholder;

            // Add AI starter message
            const messagesDiv = document.getElementById('messages');
            const starterMessage = document.createElement('div');
            starterMessage.className = 'message ai-message';
            starterMessage.innerHTML = `
                <div class="message-content">
                    <span class="message-icon">ü§ñ</span>
                    <div class="message-text">
                        <p>Hi! üëã I'm your AI assistant. I can help you learn about creating your store, features, pricing, or answer any questions about our platform. What would you like to know?</p>
                    </div>
                </div>
            `;
            messagesDiv.appendChild(starterMessage);

            // About Section
            document.getElementById('about-title').textContent = desktopPage.about.title;
            document.getElementById('about-subtitle').textContent = desktopPage.about.subtitle;
            document.getElementById('about-emoji').textContent = desktopPage.about.emoji;

            const aboutParagraphs = document.getElementById('about-paragraphs');
            aboutParagraphs.innerHTML = desktopPage.about.content.map(p => `<p>${p}</p>`).join('');

            // CTA Section
            document.getElementById('cta-title').textContent = desktopPage.cta.title;
            document.getElementById('cta-description').textContent = desktopPage.cta.description;
            document.getElementById('cta-button').textContent = desktopPage.cta.buttonText;
            document.getElementById('cta-button').href = desktopPage.cta.buttonLink;

            // Footer
            document.getElementById('footer-tagline').textContent = desktopPage.footer.tagline;
            document.getElementById('footer-copyright').textContent = desktopPage.footer.copyright;

            const footerLinks = document.getElementById('footer-links');
            footerLinks.innerHTML = desktopPage.footer.links.map(link =>
                `<a href="${link.url}">${link.text}</a>`
            ).join('');

            console.log('[Index] Platform landing page loaded from config');

            // Remove loading state - trigger fade-out and content reveal
            // Only if loading was shown (first visit)
            if (isFirstVisit) {
                requestAnimationFrame(() => {
                    document.body.classList.remove('is-loading');

                    // Remove edge loader from DOM after fade-out completes
                    setTimeout(() => {
                        const edgeLoader = document.getElementById('edge-loader');
                        if (edgeLoader) {
                            edgeLoader.remove();
                        }
                    }, 600); // Match CSS transition duration
                });
            }
        });
    </script>

    <!-- Service Worker for Caching -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('[ServiceWorker] Registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('[ServiceWorker] Registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
