<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="./js/clean-url.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon Tide Workshops - Desktop</title>

    <meta property="og:type" content="website">
    <meta property="og:title" content="Moon Tide Workshops">
    <meta property="og:description" content="Browse all transformative cultural workshops and experiences offered by Moon Tide Reconciliation.">

    <link rel="stylesheet" href="/css/fullscreen-modals.css">
</head>
<body>
    <div class="fullscreen-modal-backdrop">
        <div class="fullscreen-modal">
            <!-- Header -->
            <div class="modal-header-game">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span class="modal-title-emoji">ðŸ“…</span>
                    <h1 class="modal-title-game" style="margin: 0;">Moon Tide Workshops</h1>
                </div>
                <div class="modal-header-disclaimer">
                    All workshop prices shown are per person and based on a minimum of 10 participants.
                </div>
                <button class="modal-close-btn" onclick="navigateBack()" title="Close">âœ•</button>
            </div>

            <!-- Mobile Disclaimer (hidden on desktop) -->
            <div class="modal-disclaimer-mobile">
                All workshop prices shown are per person and based on a minimum of 10 participants.
            </div>

            <!-- Content Area -->
            <div class="modal-content-game">
                <div class="services-grid" id="workshopGrid">
                    <!-- Workshop cards will be dynamically inserted here -->
                </div>
            </div>

            <!-- Footer Close Button -->
            <button class="modal-footer-close-btn" onclick="navigateBack()">Close</button>
        </div>
    </div>

    <!-- Config System: Theme & Content Loaders -->
    <script type="module">
        import { injectTheme } from './js/theme-injector.js';
        import { loadPageContent } from './js/content-loader.js';
        import { getAllServices, services } from './js/config/index.js';

        // Initialize theme and content
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[Workshop List] Initializing from config...');

            // Inject theme
            injectTheme();

            // Load page content
            loadPageContent('services', { updateMetaTags: true, updateTitle: true });
        });

        // Populate workshop grid from config system
        const grid = document.getElementById('workshopGrid');
        const allServices = getAllServices();

        // Filter to only show workshops (type === 'workshop')
        const workshops = allServices.filter(service => service.type === 'workshop');

        workshops.forEach(workshop => {
            // Create card
            const card = document.createElement('div');
            card.className = 'service-card';
            card.style.cursor = 'pointer';

            // Image section
            const imageDiv = document.createElement('div');
            imageDiv.className = 'service-card-image';

            if (workshop.image) {
                const img = document.createElement('img');
                img.src = workshop.image;
                img.alt = workshop.name;
                img.onerror = () => {
                    // If image fails to load, use emoji placeholder
                    imageDiv.textContent = workshop.emoji || 'ðŸŽ¯';
                    imageDiv.classList.add('placeholder');
                };
                imageDiv.appendChild(img);
            } else {
                // Use emoji placeholder
                imageDiv.classList.add('placeholder');
                imageDiv.textContent = workshop.emoji || 'ðŸŽ¯';
            }

            card.appendChild(imageDiv);

            // Content section
            const cardContent = document.createElement('div');
            cardContent.className = 'service-card-content';

            // Emoji
            const emoji = document.createElement('div');
            emoji.className = 'service-card-emoji';
            emoji.textContent = workshop.emoji || 'ðŸŽ¯';
            cardContent.appendChild(emoji);

            // Name
            const name = document.createElement('h3');
            name.className = 'service-card-name';
            name.textContent = workshop.name;
            cardContent.appendChild(name);

            // Description
            const description = document.createElement('p');
            description.className = 'service-card-description';
            description.textContent = workshop.description;
            cardContent.appendChild(description);

            // Meta information
            const meta = document.createElement('div');
            meta.className = 'service-card-meta';

            // Format price from config
            const priceItem = document.createElement('div');
            priceItem.className = 'service-meta-item';
            if (workshop.pricing && workshop.pricing.enabled) {
                const communityPrice = (workshop.pricing.community / 100).toFixed(2);
                const corporatePrice = (workshop.pricing.corporate / 100).toFixed(2);
                priceItem.innerHTML = `Price: <span class="service-meta-value">$${communityPrice} (Community) / $${corporatePrice} (Corporate)</span>`;
            } else {
                priceItem.innerHTML = `Price: <span class="service-meta-value">Contact for pricing</span>`;
            }

            const durationItem = document.createElement('div');
            durationItem.className = 'service-meta-item';
            durationItem.innerHTML = `Duration: <span class="service-meta-value">${workshop.duration || 'Contact for details'}</span>`;

            meta.appendChild(priceItem);
            meta.appendChild(durationItem);
            cardContent.appendChild(meta);

            // Action button
            const actionBtn = document.createElement('button');
            actionBtn.className = 'service-card-action';
            actionBtn.textContent = 'View Details';

            // Click handler - navigate to workshop detail page
            const navigateToDetail = () => {
                window.location.href = `/workshop-detail?id=${workshop.id}`;
            };

            actionBtn.addEventListener('click', navigateToDetail);
            card.addEventListener('click', navigateToDetail);

            cardContent.appendChild(actionBtn);
            card.appendChild(cardContent);

            // Add hover effects
            card.addEventListener('mouseenter', () => {
                card.style.zIndex = '1';
            });

            grid.appendChild(card);
        });
    </script>

    <script>
        function navigateBack() {
            window.location.href = '/menu';
        }

        // ESC key support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                navigateBack();
            }
        });
    </script>
</body>
</html>
