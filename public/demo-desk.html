<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="./js/clean-url.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AARIE.CA - We Build Your Store</title>

    <meta property="og:type" content="website">
    <meta property="og:title" content="AARIE.CA - We Build Your Store">
    <meta property="og:description" content="We build professional online stores in 24-48 hours - you don't have to lift a finger">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>ğŸª</text></svg>">

    <!-- CSS -->
    <link rel="stylesheet" href="./css/demo-store.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="nav-bar">
        <div class="nav-container">
            <div class="nav-left">
                <a href="/index.html" class="nav-back-button" title="Back to Platform">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </a>
                <a href="/index.html" class="nav-logo">
                    <span class="nav-logo-icon" id="store-icon">ğŸª</span>
                    <span id="store-name">AARIE.CA</span>
                </a>
            </div>
            <div class="nav-links">
                <a href="/store-booking.html" class="nav-link"><span>ğŸª</span> Get a Store</a>
                <a href="/about-desk.html" class="nav-link"><span>â„¹ï¸</span> About</a>
                <a href="/contact-desk.html" class="nav-link"><span>ğŸ“¬</span> Contact</a>
                <a href="/ai-chat-desk.html" class="nav-link"><span>ğŸ¤–</span> A.I. Chat</a>
            </div>
            <!-- Mobile Hamburger Menu Button -->
            <button class="mobile-hamburger" onclick="toggleMobileMenu()" aria-label="Menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="closeMobileMenu()"></div>

    <!-- Mobile Menu Drawer -->
    <div class="mobile-menu-drawer" id="mobileMenuDrawer">
        <div class="mobile-menu-header">
            <span class="mobile-menu-logo">ğŸª AARIE.CA</span>
            <button class="mobile-menu-close" onclick="closeMobileMenu()">âœ•</button>
        </div>
        <nav class="mobile-menu-nav">
            <a href="/store-booking.html" class="mobile-menu-link" onclick="closeMobileMenu()">
                <span class="mobile-menu-icon">ğŸª</span>
                <span>Get a Store</span>
            </a>
            <a href="/about-desk.html" class="mobile-menu-link" onclick="closeMobileMenu()">
                <span class="mobile-menu-icon">â„¹ï¸</span>
                <span>About</span>
            </a>
            <a href="/contact-desk.html" class="mobile-menu-link" onclick="closeMobileMenu()">
                <span class="mobile-menu-icon">ğŸ“¬</span>
                <span>Contact</span>
            </a>
            <a href="javascript:void(0)" class="mobile-menu-link" onclick="closeMobileMenu(); openMobileChat();">
                <span class="mobile-menu-icon">ğŸ¤–</span>
                <span>A.I. Chat</span>
            </a>
        </nav>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <span class="hero-emoji" id="hero-emoji">ğŸª</span>
            <h1 class="hero-title" id="hero-title">Let Us Build Your Store</h1>
            <p class="hero-subtitle" id="hero-subtitle">Place a deposit today and get your store live in 24-48 hours</p>
            <p class="hero-description" id="hero-description">Stop waiting months for a website. We handle everything - design, setup, products, checkout, and a custom AI chatbot. You focus on your business, we build your online presence.</p>
            <a href="/store-booking.html" class="hero-cta" id="hero-cta">Get Started Now</a>
        </div>
    </section>

    <!-- Featured Products -->
    <section class="products-section">
        <div class="section-header">
            <h2 class="section-title" id="products-title">Book Your Store Today</h2>
            <p class="section-subtitle" id="products-subtitle">Start selling online with just a deposit</p>
        </div>
        <div class="products-grid" id="products-grid">
            <!-- Populated by JS -->
        </div>
    </section>

    <!-- Features -->
    <section class="features-section">
        <div class="features-grid" id="features-grid">
            <!-- Populated by JS -->
        </div>
    </section>

    <!-- About -->
    <section class="about-section" id="about">
        <div class="about-content">
            <div class="about-text">
                <h2 id="about-title">Why Choose AARIE.CA</h2>
                <h3 id="about-subtitle">Your online store, built by professionals</h3>
                <div id="about-paragraphs">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="about-visual">
                <span class="about-emoji" id="about-emoji">ğŸ’³</span>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p class="footer-tagline" id="footer-tagline">AARIE.CA - We Build Your Store in 24-48 Hours</p>
        <p class="footer-links">
            <a href="/developer-desk.html" class="footer-link">Contact the Developer</a>
        </p>
        <p class="footer-copyright" id="footer-copyright">Â© 2025 AARIE.CA. All rights reserved.</p>
    </footer>

    <!-- AI Chat Icon (Bottom Right) - Desktop -->
    <button class="ai-chat-icon" onclick="openAIChat()" title="Chat with AI Assistant">
        ğŸ¤–
    </button>

    <!-- AI Chat Modal Overlay - Desktop -->
    <div class="ai-chat-overlay" id="aiChatOverlay" onclick="closeAIChat()"></div>

    <!-- AI Chat Modal - Desktop -->
    <div class="ai-chat-modal" id="aiChatModal">
        <div class="chat-modal-header">
            <h3 class="chat-modal-title">ğŸ¤– AI Assistant</h3>
            <button class="chat-modal-close" onclick="closeAIChat()">âœ•</button>
        </div>
        <div class="chat-modal-body">
            <div class="messages" id="aiMessages">
                <div class="message ai-message">
                    Hi! ğŸ‘‹ I'm the AI assistant from AARIE.CA. We build professional online stores in just 24-48 hours. Ask me anything about our services, pricing, or how we can help your business!
                </div>
            </div>
        </div>
        <div class="chat-modal-input">
            <input type="text" placeholder="Ask me anything..." id="aiChatInput" />
            <button onclick="sendAIMessage()">Send</button>
        </div>
    </div>

    <!-- Mobile Floating Chat Button -->
    <button class="mobile-chat-fab" onclick="openMobileChat()" title="Chat with AI">
        ğŸ¤–
    </button>

    <!-- Mobile Chat Overlay -->
    <div class="mobile-chat-overlay" id="mobileChatOverlay" onclick="closeMobileChat()"></div>

    <!-- Mobile Fullscreen Chat Modal -->
    <div class="mobile-chat-modal" id="mobileChatModal">
        <div class="mobile-chat-header">
            <h3 class="mobile-chat-title">ğŸ¤– AI Assistant</h3>
            <button class="mobile-chat-close" onclick="closeMobileChat()">âœ•</button>
        </div>
        <div class="mobile-chat-body">
            <div class="mobile-chat-messages" id="mobileChatMessages">
                <div class="mobile-chat-message ai">
                    Hi! ğŸ‘‹ I'm the AI assistant from AARIE.CA. We build professional online stores in just 24-48 hours. Ask me anything about our services, pricing, or how we can help your business!
                </div>
            </div>
            <div class="mobile-typing-indicator" id="mobileTypingIndicator">
                <span class="mobile-typing-dot"></span>
                <span class="mobile-typing-dot"></span>
                <span class="mobile-typing-dot"></span>
            </div>
        </div>
        <div class="mobile-chat-input-area">
            <input type="text" class="mobile-chat-input" id="mobileChatInput" placeholder="Ask me anything..." maxlength="4000">
            <button class="mobile-chat-send" onclick="sendMobileMessage()">Send</button>
        </div>
    </div>

    <!-- Config System -->
    <script type="module">
        import { injectTheme } from './js/theme-injector.js';
        import demoStore from './js/config/content/demo-store.js';

        // Inject theme
        injectTheme();

        // Populate content
        document.addEventListener('DOMContentLoaded', () => {
            // Store name and icon
            document.getElementById('store-icon').textContent = demoStore.storeIcon;
            document.getElementById('store-name').textContent = demoStore.storeName;

            // Hero
            document.getElementById('hero-emoji').textContent = demoStore.hero.backgroundEmoji;
            document.getElementById('hero-title').textContent = demoStore.hero.title;
            document.getElementById('hero-subtitle').textContent = demoStore.hero.subtitle;
            document.getElementById('hero-description').textContent = demoStore.hero.description;
            document.getElementById('hero-cta').textContent = demoStore.hero.ctaText;
            document.getElementById('hero-cta').href = demoStore.hero.ctaLink;

            // Featured Products
            document.getElementById('products-title').textContent = demoStore.featuredProducts.title;
            document.getElementById('products-subtitle').textContent = demoStore.featuredProducts.subtitle;

            const productsGrid = document.getElementById('products-grid');
            productsGrid.innerHTML = demoStore.featuredProducts.products.map(product => `
                <div class="product-card" onclick="window.location.href='${product.link}'">
                    <div class="product-icon">${product.emoji}</div>
                    <div class="product-content">
                        <h3 class="product-name">${product.name}</h3>
                        <p class="product-description">${product.description}</p>
                        <div class="product-price">${product.price}</div>
                        <a href="${product.link}" class="product-link">Get Started</a>
                    </div>
                </div>
            `).join('');

            // Features
            const featuresGrid = document.getElementById('features-grid');
            featuresGrid.innerHTML = demoStore.features.map(feature => `
                <div class="feature-card">
                    <span class="feature-icon">${feature.icon}</span>
                    <h3 class="feature-title">${feature.title}</h3>
                    <p class="feature-description">${feature.description}</p>
                </div>
            `).join('');

            // About
            document.getElementById('about-title').textContent = demoStore.about.title;
            document.getElementById('about-subtitle').textContent = demoStore.about.subtitle;
            document.getElementById('about-emoji').textContent = demoStore.about.emoji;

            const aboutParagraphs = document.getElementById('about-paragraphs');
            aboutParagraphs.innerHTML = demoStore.about.content.map(p => `<p>${p}</p>`).join('');

            // Footer
            document.getElementById('footer-tagline').textContent = demoStore.footer.tagline;
            document.getElementById('footer-copyright').textContent = demoStore.footer.copyright;
        });
    </script>

    <!-- Mobile Menu Functions -->
    <script>
        function toggleMobileMenu() {
            const drawer = document.getElementById('mobileMenuDrawer');
            const overlay = document.getElementById('mobileMenuOverlay');
            drawer.classList.toggle('active');
            overlay.classList.toggle('active');
            document.body.style.overflow = drawer.classList.contains('active') ? 'hidden' : '';
        }

        function closeMobileMenu() {
            const drawer = document.getElementById('mobileMenuDrawer');
            const overlay = document.getElementById('mobileMenuOverlay');
            drawer.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }
    </script>

    <!-- AI Chat Functions -->
    <script>
        // ========================================
        // BACKEND CONFIGURATION
        // ========================================
        const BACKEND_URL = 'https://stores-backend-phhl2xgwwa-uc.a.run.app';
        const CHAT_ENDPOINT = '/chat';

        // Session management
        let CHAT_SESSION_ID = null;
        let MOBILE_CHAT_SESSION_ID = null;

        // Initialize session on page load
        function initializeChatSession() {
            CHAT_SESSION_ID = sessionStorage.getItem('demo_chat_session_id');
            if (!CHAT_SESSION_ID) {
                CHAT_SESSION_ID = 'demo_session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                sessionStorage.setItem('demo_chat_session_id', CHAT_SESSION_ID);
                console.log('[Demo Chat] New session:', CHAT_SESSION_ID);
            }
        }

        function initMobileChatSession() {
            MOBILE_CHAT_SESSION_ID = sessionStorage.getItem('mobile_chat_session_id');
            if (!MOBILE_CHAT_SESSION_ID) {
                MOBILE_CHAT_SESSION_ID = 'mobile_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                sessionStorage.setItem('mobile_chat_session_id', MOBILE_CHAT_SESSION_ID);
            }
        }

        // Desktop Chat Functions
        function openAIChat() {
            document.getElementById('aiChatModal').classList.add('active');
            document.getElementById('aiChatOverlay').classList.add('active');
            document.getElementById('aiChatInput').focus();
        }

        function closeAIChat() {
            document.getElementById('aiChatModal').classList.remove('active');
            document.getElementById('aiChatOverlay').classList.remove('active');
        }

        async function sendAIMessage() {
            const input = document.getElementById('aiChatInput');
            const messagesDiv = document.getElementById('aiMessages');
            const userText = input.value.trim();

            if (!userText) return;

            // Disable input while sending
            input.disabled = true;

            // Clear previous messages - only show current exchange
            messagesDiv.innerHTML = '';

            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'message user-message';
            userMsg.textContent = userText;
            messagesDiv.appendChild(userMsg);
            input.value = '';
            messagesDiv.scrollTop = 0;

            try {
                const payload = {
                    session_id: CHAT_SESSION_ID,
                    prompt: userText,
                    device_fingerprint: 'demo-store-' + navigator.userAgent.substring(0, 50)
                };

                console.log('[Demo Chat] Sending:', userText.substring(0, 50) + '...');

                const response = await fetch(BACKEND_URL + CHAT_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const aiResponse = data.response || 'Sorry, I could not generate a response.';

                console.log('[Demo Chat] Response:', aiResponse.substring(0, 50) + '...');

                // Add AI message
                const aiMsg = document.createElement('div');
                aiMsg.className = 'message ai-message';
                aiMsg.textContent = aiResponse;
                messagesDiv.appendChild(aiMsg);
                messagesDiv.scrollTop = 0;

            } catch (error) {
                console.error('[Demo Chat] Error:', error);

                const aiMsg = document.createElement('div');
                aiMsg.className = 'message ai-message';
                aiMsg.textContent = 'Sorry, I encountered an error. Please try again.';
                messagesDiv.appendChild(aiMsg);
                messagesDiv.scrollTop = 0;
            } finally {
                // Re-enable input
                input.disabled = false;
                input.focus();
            }
        }

        // Mobile Chat Functions
        function openMobileChat() {
            document.getElementById('mobileChatModal').classList.add('active');
            document.getElementById('mobileChatOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
            // Don't auto-focus - let user see chat and choose to type
        }

        function closeMobileChat() {
            document.getElementById('mobileChatModal').classList.remove('active');
            document.getElementById('mobileChatOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function sendMobileMessage() {
            const input = document.getElementById('mobileChatInput');
            const messagesDiv = document.getElementById('mobileChatMessages');
            const typingIndicator = document.getElementById('mobileTypingIndicator');
            const userText = input.value.trim();

            if (!userText) return;

            input.disabled = true;

            // Clear previous messages - only show current exchange
            messagesDiv.innerHTML = '';

            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'mobile-chat-message user';
            userMsg.textContent = userText;
            messagesDiv.appendChild(userMsg);
            input.value = '';
            messagesDiv.scrollTop = 0;

            // Show typing indicator
            typingIndicator.classList.add('visible');

            try {
                const payload = {
                    session_id: MOBILE_CHAT_SESSION_ID,
                    prompt: userText,
                    device_fingerprint: 'mobile-demo-' + navigator.userAgent.substring(0, 50)
                };

                const response = await fetch(BACKEND_URL + CHAT_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const aiResponse = data.response || 'Sorry, I could not generate a response.';

                // Hide typing indicator
                typingIndicator.classList.remove('visible');

                // Add AI message
                const aiMsg = document.createElement('div');
                aiMsg.className = 'mobile-chat-message ai';
                aiMsg.textContent = aiResponse;
                messagesDiv.appendChild(aiMsg);
                messagesDiv.scrollTop = 0;

            } catch (error) {
                console.error('[Mobile Chat] Error:', error);
                typingIndicator.classList.remove('visible');

                const aiMsg = document.createElement('div');
                aiMsg.className = 'mobile-chat-message ai';
                aiMsg.textContent = 'Sorry, I encountered an error. Please try again.';
                messagesDiv.appendChild(aiMsg);
                messagesDiv.scrollTop = 0;
            } finally {
                input.disabled = false;
                // Close keyboard after sending
                input.blur();
                messagesDiv.focus();
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeChatSession();
            initMobileChatSession();

            // Desktop chat input
            document.getElementById('aiChatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !document.getElementById('aiChatInput').disabled) {
                    sendAIMessage();
                }
            });

            // Mobile chat input
            const mobileInput = document.getElementById('mobileChatInput');
            if (mobileInput) {
                mobileInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !mobileInput.disabled) {
                        sendMobileMessage();
                    }
                });
            }

            // Close modals with Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAIChat();
                    closeMobileChat();
                    closeMobileMenu();
                }
            });
        });
    </script>
</body>
</html>
