rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ============== CLIENTS ==============
    // Each client can only see their own data

    match /clients/{clientUid} {
      // Client can read/write their own document
      allow read, write: if request.auth.uid == clientUid;

      // ============== CLIENT STRIPE ACCOUNT ==============
      match /stripe_account/{document=**} {
        allow read, write: if request.auth.uid == clientUid;
      }

      // ============== CLIENT PRODUCTS ==============
      match /products/{document=**} {
        allow read, write: if request.auth.uid == clientUid;
      }

      // ============== CLIENT TRANSACTIONS ==============
      match /transactions/{document=**} {
        // Client can read their own transactions
        allow read: if request.auth.uid == clientUid;
        // Backend can create transactions (via API, auth checked there)
        allow create: if request.resource.data.stripePaymentId != null;
      }
    }

    // ============== DENY ALL OTHER ACCESS ==============
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
